#!/usr/bin/make -f
# -*- makefile -*-

export DH_VERBOSE = 1

%:
	dh $@

override_dh_auto_build:

override_dh_auto_install:
	# Install application files
	install -d $(CURDIR)/debian/visual-page-editor/usr/share/visual-page-editor
	cp -r html css js examples plugins xsd xslt package.json LICENSE.md README.md $(CURDIR)/debian/visual-page-editor/usr/share/visual-page-editor/
	
	# Install NW.js runtime
	install -d $(CURDIR)/debian/visual-page-editor/usr/lib/visual-page-editor
	cp -r nwjs $(CURDIR)/debian/visual-page-editor/usr/lib/visual-page-editor/
	
	# Install launcher script
	install -d $(CURDIR)/debian/visual-page-editor/usr/bin
	install -m 755 bin/visual-page-editor $(CURDIR)/debian/visual-page-editor/usr/bin/visual-page-editor
	
	# Prefer bundled NW.js and app path for Debian install
	awk '/^  # Linux and others/ { print; print "  nw=\"/usr/lib/visual-page-editor/nwjs/nw\""; print "  [ ! -f \"" "$$" "nw\" ] &&"; next } \
	/^  nw_page_editor=\"\$$nw_page_editor\/share\/nw-page-editor\";?$$/ { print; print "  [ ! -f \"" "$$" "nw_page_editor/js/nw-app.js\" ] && [ -f \"/usr/share/visual-page-editor/js/nw-app.js\" ] && nw_page_editor=\"/usr/share/visual-page-editor\""; next } \
	{ print }' $(CURDIR)/debian/visual-page-editor/usr/bin/visual-page-editor > $(CURDIR)/debian/visual-page-editor/usr/bin/visual-page-editor.tmp && \
	chmod 755 $(CURDIR)/debian/visual-page-editor/usr/bin/visual-page-editor.tmp && \
	mv $(CURDIR)/debian/visual-page-editor/usr/bin/visual-page-editor.tmp $(CURDIR)/debian/visual-page-editor/usr/bin/visual-page-editor
	
	# Install documentation
	install -d $(CURDIR)/debian/visual-page-editor/usr/share/doc/visual-page-editor
	cp README.md BUILD.md PACKAGING.md LICENSE.md $(CURDIR)/debian/visual-page-editor/usr/share/doc/visual-page-editor/ 2>/dev/null || true
